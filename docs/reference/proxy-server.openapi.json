{
  "openapi": "3.1.0",
  "info": {
    "title": "proxy-server",
    "description": "",
    "license": {
      "name": "Apache-2.0"
    },
    "version": "2026.02.24-3bc3da88"
  },
  "paths": {
    "/api/admin/bump-config-epoch": {
      "post": {
        "tags": [
          "config"
        ],
        "summary": "Allows the system operator to trigger a configuration epoch bump,\nwhich causes various configs that are using the Epoch strategy to\nbe re-evaluated by triggering the appropriate callbacks.",
        "operationId": "bump_config_epoch",
        "responses": {
          "200": {
            "description": "bump successful"
          }
        }
      }
    },
    "/api/admin/memory/stats": {
      "get": {
        "tags": [
          "memory"
        ],
        "summary": "Returns information about the system memory usage in an unstructured\nhuman readable format.  The output is not machine parseable and may\nchange without notice between versions of kumomta.",
        "operationId": "memory_stats",
        "responses": {
          "200": {
            "description": "stats were returned"
          }
        }
      }
    },
    "/api/admin/set_diagnostic_log_filter/v1": {
      "post": {
        "tags": [
          "logging",
          "kcli:set-log-filter"
        ],
        "summary": "Changes the diagnostic log filter dynamically.\nSee <https://docs.kumomta.com/reference/kumo/set_diagnostic_log_filter/>\nfor more information on diagnostic log filters.",
        "operationId": "set_diagnostic_log_filter_v1",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SetDiagnosticFilterRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Diagnostic level set successfully"
          }
        }
      }
    },
    "/api/machine-info": {
      "get": {
        "tags": [
          "debugging"
        ],
        "summary": "Returns information identifying this instance",
        "operationId": "machine_info",
        "responses": {
          "200": {
            "description": "Machine information",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MachineInfoV1"
                }
              }
            }
          }
        }
      }
    },
    "/metrics": {
      "get": {
        "tags": [],
        "summary": "Returns the current set of metrics in\n[Prometheus Text Exposition Format](https://prometheus.io/docs/instrumenting/exposition_formats/).",
        "description": "!!! note\n    Metrics generally represent data at the current point in time,\n    to be consumed by an external system (such as Prometheus) which\n    then in turn can build time series data around those metrics.\n\n    In addition, in order to avoid unbounded RAM usage for systems\n    with many queues, a number of queue- or service-specific metrics\n    will be automatically pruned away when the corresponding queue\n    idles out for a period of time.\n\nIn the default configuration, access to this endpoint requires *Trusted IP*\nauthentication.  See the [Authorization](../../access_control.md) documentation\nfor more information on adjusting ACLs.\n\nSee also [metrics.json](metrics.json_get.md).\n\n## Metric Documentation\n\n* [Metrics exported by kumod](../../metrics/kumod/index.md)\n\n## Example Data\n\nHere's an example of the shape of the data.  The precise set of\ncounters will vary as we continue to enhance KumoMTA.\n\nYou can see the current list by querying the endpoint with no arguments:\n\n```console\n$ curl http://localhost:8000/metrics\n```\n\n```txt\n{% include \"reference/http/sample-metrics.txt\" %}\n```",
        "operationId": "report_metrics",
        "responses": {
          "200": {
            "description": "",
            "content": {
              "text/plain": {}
            }
          }
        }
      }
    },
    "/metrics.json": {
      "get": {
        "tags": [],
        "summary": "Returns the current set of metrics in a json representation.\nThis is easier to consume than the Prometheus Exposition format, but\nis more resource intensive to produce and parse when the number of\nmetrics is large, such as for a busy server.",
        "description": "!!! note\n    Metrics generally represent data at the current point in time,\n    to be consumed by an external system (such as Prometheus) which\n    then in turn can build time series data around those metrics.\n\n    In addition, in order to avoid unbounded RAM usage for systems\n    with many queues, a number of queue- or service-specific metrics\n    will be automatically pruned away when the corresponding queue\n    idles out for a period of time.\n\nIn the default configuration, access to this endpoint requires *Trusted IP*\nauthentication.  See the [Authorization](../../access_control.md) documentation\nfor more information on adjusting ACLs.\n\nSee also [metrics](metrics_get.md).\n\n## Metric Documentation\n\n* [Metrics exported by kumod](../../metrics/kumod/index.md)\n\n## Example Data\n\nHere's an example of the shape of the data.  The precise set of\ncounters will vary as we continue to enhance KumoMTA:\n\n```json\n{% include \"reference/http/sample-metrics.json\" %}\n```",
        "operationId": "report_metrics_json",
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {}
            }
          }
        }
      }
    },
    "/proxy/status": {
      "get": {
        "tags": [
          "status"
        ],
        "summary": "Simple health check endpoint for the proxy.\nReturns basic status information.",
        "operationId": "proxy_status",
        "responses": {
          "200": {
            "description": "Proxy is healthy",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "MachineInfoV1": {
        "type": "object",
        "required": [
          "node_id",
          "hostname",
          "mac_address",
          "num_cores",
          "platform",
          "distribution",
          "os_version",
          "total_memory_bytes",
          "cpu_brand",
          "fingerprint",
          "online_since",
          "process_kind",
          "version"
        ],
        "properties": {
          "container_runtime": {
            "type": [
              "string",
              "null"
            ],
            "description": "If we detected that we're running in a container, the name\nof the container runtime"
          },
          "cpu_brand": {
            "type": "string",
            "description": "Identifies the CPU.  If you have a mixture of different CPUs,\nthis will be a comma separated list of the different CPUs",
            "example": "Intel(R) Xeon(R) CPU E5-2686 v4 @ 2.30GHz"
          },
          "distribution": {
            "type": "string",
            "description": "The OS distribution",
            "example": "ubuntu"
          },
          "fingerprint": {
            "type": "string",
            "description": "Additional metadata hash(es) that can identify the running machine.\nFor example, when running in AWS, the instance-id will be\nincluded.",
            "example": "aws_instance_id=i-09aebefac97cf0000,machine_uid=ec22130d1de33cf52413457ac040000"
          },
          "hostname": {
            "type": "string",
            "description": "The hostname of the system, as reported by `gethostname(2)`",
            "example": "mta1.example.com"
          },
          "kernel_version": {
            "type": [
              "string",
              "null"
            ],
            "description": "The kernel version",
            "example": "6.8.0-1016-aws"
          },
          "mac_address": {
            "type": "string",
            "description": "The MAC address of the primary, non-loopback, network interface",
            "example": "02:02:02:02:02:02"
          },
          "node_id": {
            "type": "string",
            "description": "The NodeID of the system",
            "example": "9745bb48-14d7-48f2-a1fb-7df8d5844217"
          },
          "num_cores": {
            "type": "integer",
            "description": "The number of available CPUs as reported by\n<https://docs.rs/num_cpus/latest/num_cpus/fn.get.html>",
            "example": 64,
            "minimum": 0
          },
          "online_since": {
            "type": "string",
            "format": "date-time",
            "description": "The date/time at which the process was last started"
          },
          "os_version": {
            "type": "string",
            "description": "The OS version (which often includes the distribution)",
            "example": "Linux (Ubuntu 24.04)"
          },
          "platform": {
            "type": "string",
            "description": "Identifies the running platform",
            "example": "linux/x86_64"
          },
          "process_kind": {
            "type": "string",
            "description": "Which process is running. eg: `kumod` vs `tsa-daemon` vs. `proxy-server`.",
            "example": "kumod"
          },
          "total_memory_bytes": {
            "type": "integer",
            "format": "u-int64",
            "description": "Total physical memory installed in the instance",
            "example": 1003929600,
            "minimum": 0
          },
          "version": {
            "type": "string",
            "description": "The version of KumoMTA that is running",
            "example": "2026.02.24-2d1a3174"
          }
        }
      },
      "SetDiagnosticFilterRequest": {
        "type": "object",
        "required": [
          "filter"
        ],
        "properties": {
          "filter": {
            "type": "string",
            "description": "The diagnostic filter spec to use",
            "example": "kumod=trace"
          }
        }
      }
    },
    "securitySchemes": {
      "basic_auth": {
        "type": "http",
        "scheme": "basic"
      }
    }
  },
  "security": [
    {
      "basic_auth": [
        ""
      ]
    }
  ]
}
